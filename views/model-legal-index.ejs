<!-- FILE: views/model-legal-index.ejs -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Legal Documents – LumenNyx Studios</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/css/style.css" />

  <style>
    .wrap { max-width: 1100px; margin: 1.5rem auto 2rem auto; padding: 0 1.25rem; }
    .muted { color:#9aa0b5; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:0.92rem; }

    .grid { display:grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 920px) { .grid { grid-template-columns: 1.25fr 0.75fr; } }

    .card {
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 16px;
      background: rgba(0,0,0,0.25);
      padding: 16px;
    }

    .title-row { display:flex; align-items:flex-start; justify-content:space-between; gap: 12px; }
    .title-row h2 { margin: 0; }
    .sub { margin: 8px 0 0 0; }

    .pill {
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 5px 10px;
      border-radius: 999px;
      font-size: 0.85rem;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.25);
      white-space: nowrap;
    }
    .pill.ok { border-color: rgba(0,255,160,0.25); }
    .pill.warn { border-color: rgba(255,200,60,0.30); }
    .pill.bad { border-color: rgba(255,80,80,0.30); }

    .list { width:100%; border-collapse: collapse; }
    .list th, .list td { padding: 12px 10px; border-bottom: 1px solid rgba(255,255,255,0.08); vertical-align: top; }
    .list th { text-align:left; color: rgba(255,255,255,0.85); font-weight: 600; }
    .list td { color: rgba(255,255,255,0.92); }

    .actions { display:flex; gap:10px; flex-wrap: wrap; justify-content:flex-end; }
    .btn.small { padding: 0.35rem 0.85rem; font-size: 0.85rem; }

    .kpi { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px; }
    .kpi .box {
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 14px;
      padding: 12px;
      background: rgba(0,0,0,0.18);
    }
    .kpi .num { font-size: 1.25rem; font-weight: 700; margin-top: 6px; }

    .hint { margin-top: 10px; line-height: 1.45; }
    .banner { margin: 12px 0; }
    .btnrow { display:flex; gap:8px; justify-content:flex-end; flex-wrap:wrap; }
  </style>
</head>

<body>
  <header class="site-header">
    <div class="site-header-inner">
      <a href="/" class="brand-link">
        <span class="brand-mark">
          <img src="/img/lumennyx-mark.png" alt="LumenNyx logo">
        </span>
        <span class="brand-text">LUMENNYX STUDIOS</span>
      </a>

      <nav class="main-nav">
        <a href="/model/profile">Model Portal</a>
        <a href="/model/bookings">My Bookings</a>
        <a href="/model/scenes">My Scenes</a>
        <a href="/model/signature">Signature</a>
        <a href="/model/legal" class="active">Legal</a>
        <form action="/logout" method="POST" style="display:inline;">
          <button class="btn secondary" style="padding:0.25rem 0.9rem;font-size:0.8rem;">Logout</button>
        </form>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <% if (message) { %>
      <div class="alert success banner"><%= message %></div>
    <% } %>
    <% if (error) { %>
      <div class="alert error banner"><%= error %></div>
    <% } %>

    <section class="card">
      <div class="title-row">
        <div>
          <h2>Legal Documents</h2>
          <p class="muted sub">
            Review and sign the studio legal documents. These documents require additional information (not just a signature).
            Completed items will show as signed. If a document is updated, you may be asked to re-sign.
          </p>
        </div>
        <div class="actions">
          <a class="btn secondary small" href="/model/profile">Back to Profile</a>
          <a class="btn secondary small" href="/model/signature">Signature Setup</a>
        </div>
      </div>

      <div class="kpi">
        <div class="box">
          <div class="pill <%= (requiredMissing === 0 && requiredNeedsResign === 0) ? 'ok' : 'warn' %>">
            Required Status
          </div>
          <div class="num">
            <% if (requiredMissing === 0 && requiredNeedsResign === 0) { %>
              Complete
            <% } else { %>
              Action Needed
            <% } %>
          </div>
          <div class="muted">
            Missing: <span class="mono"><%= requiredMissing %></span> · Needs re-sign: <span class="mono"><%= requiredNeedsResign %></span>
          </div>
        </div>

        <div class="box">
          <div class="pill ok">Account</div>
          <div class="num"><%= (currentUser && currentUser.username) ? currentUser.username : 'Model' %></div>
          <div class="muted">You can return here anytime to view status.</div>
        </div>
      </div>

      <div class="hint muted">
        Tip: If a document won’t open, ensure you’re logged in as a model and your session passed the age-check.
      </div>
    </section>

    <section class="card" style="margin-top: 16px;">
      <h3 style="margin-top:0;">Document Checklist</h3>

      <% if (templates && templates.length) { %>
        <table class="list">
          <thead>
            <tr>
              <th style="width: 42%;">Document</th>
              <th style="width: 14%;">Required</th>
              <th style="width: 20%;">Status</th>
              <th style="width: 24%; text-align:right;">Action</th>
            </tr>
          </thead>
          <tbody>
            <% templates.forEach(function(t){ %>
              <tr>
                <td>
                  <div style="font-weight:700;"><%= t.title %></div>
                  <div class="muted">
                    Version: <span class="mono"><%= t.version %></span> · Slug: <span class="mono"><%= t.slug %></span>
                  </div>
                </td>

                <td>
                  <% if (t.required) { %>
                    <span class="pill warn">Required</span>
                  <% } else { %>
                    <span class="pill">Optional</span>
                  <% } %>
                </td>

                <td>
                  <% if (!t.signed) { %>
                    <span class="pill bad">Not signed</span>
                  <% } else if (t.needs_resign) { %>
                    <span class="pill warn">Re-sign needed</span>
                    <div class="muted" style="margin-top:6px;">You signed an older version.</div>
                  <% } else { %>
                    <span class="pill ok">Signed</span>
                    <% if (t.signed_at) { %>
                      <div class="muted" style="margin-top:6px;">Signed: <span class="mono"><%= t.signed_at %></span></div>
                    <% } %>
                  <% } %>
                </td>

                <td style="text-align:right;">
                  <div class="btnrow">
                    <% if (!t.signed || t.needs_resign) { %>
                      <a class="btn primary small" href="/model/legal/<%= t.slug %>">Review, Fill & Sign</a>
                    <% } else { %>
                      <a class="btn secondary small" href="/model/legal/<%= t.slug %>">View</a>
                      <% if (t.executed_id) { %>
                        <a class="btn secondary small" href="/model/legal/executed/<%= t.executed_id %>/pdf" target="_blank" rel="noopener">
                          View Executed PDF
                        </a>
                      <% } %>
                    <% } %>
                  </div>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <p class="muted">No active legal documents are available right now.</p>
      <% } %>
    </section>
  </main>
</body>
</html>
