<!-- FILE: views/model-legal-sign.ejs -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title><%= template ? template.title : 'Legal Document' %> – LumenNyx Studios</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/css/style.css" />

  <style>
    .wrap { max-width: 1100px; margin: 1.5rem auto 2rem auto; padding: 0 1.25rem; }
    .muted { color:#9aa0b5; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:0.92rem; word-break: break-word; }

    .card {
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 16px;
      background: rgba(0,0,0,0.25);
      padding: 16px;
    }

    .topbar { display:flex; align-items:flex-start; justify-content:space-between; gap: 12px; }
    .topbar h2 { margin: 0; }
    .actions { display:flex; gap:10px; flex-wrap: wrap; justify-content:flex-end; }
    .btn.small { padding: 0.35rem 0.85rem; font-size: 0.85rem; }

    .pill {
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 5px 10px;
      border-radius: 999px;
      font-size: 0.85rem;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.25);
      white-space: nowrap;
    }
    .pill.ok { border-color: rgba(0,255,160,0.25); }
    .pill.warn { border-color: rgba(255,200,60,0.30); }
    .pill.bad { border-color: rgba(255,80,80,0.30); }

    .doc {
      margin-top: 14px;
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 14px;
      background: rgba(0,0,0,0.18);
      padding: 16px;
      line-height: 1.55;
    }
    .doc h1, .doc h2, .doc h3 { margin-top: 12px; }
    .doc p { margin: 10px 0; }
    .doc ul, .doc ol { margin: 10px 0 10px 22px; }

    .sign { margin-top: 14px; display:grid; grid-template-columns: 1fr; gap: 12px; }

    .warnbox {
      border: 1px solid rgba(255,200,60,0.25);
      border-radius: 14px;
      padding: 12px;
      background: rgba(255,200,60,0.06);
    }

    .badbox {
      border: 1px solid rgba(255,80,80,0.25);
      border-radius: 14px;
      padding: 12px;
      background: rgba(255,80,80,0.06);
    }

    .infobox {
      border: 1px solid rgba(180,200,255,0.20);
      border-radius: 14px;
      padding: 12px;
      background: rgba(180,200,255,0.06);
    }

    .checkbox {
      display:flex;
      gap: 10px;
      align-items:flex-start;
      margin-top: 8px;
    }
    .checkbox input { margin-top: 3px; }

    .footer-actions { display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
  </style>
</head>

<body>
  <header class="site-header">
    <div class="site-header-inner">
      <a href="/" class="brand-link">
        <span class="brand-mark">
          <img src="/img/lumennyx-mark.png" alt="LumenNyx logo">
        </span>
        <span class="brand-text">LUMENNYX STUDIOS</span>
      </a>

      <nav class="main-nav">
        <a href="/model/profile">Model Portal</a>
        <a href="/model/legal" class="active">Legal</a>
        <a href="/model/signature">Signature</a>
        <form action="/logout" method="POST" style="display:inline;">
          <button class="btn secondary" style="padding:0.25rem 0.9rem;font-size:0.8rem;">Logout</button>
        </form>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <% if (message) { %>
      <div class="alert success"><%= message %></div>
    <% } %>
    <% if (error) { %>
      <div class="alert error"><%= error %></div>
    <% } %>

    <section class="card">
      <div class="topbar">
        <div>
          <h2><%= template ? template.title : 'Legal Document' %></h2>
          <div class="muted" style="margin-top: 6px;">
            Version: <span class="mono"><%= template ? template.version : '—' %></span>
            · Slug: <span class="mono"><%= template ? template.slug : '—' %></span>
            <% if (template && template.required) { %>
              · <span class="pill warn">Required</span>
            <% } else { %>
              · <span class="pill">Optional</span>
            <% } %>
          </div>
        </div>

        <div class="actions">
          <a class="btn secondary small" href="/model/legal">Back to Legal</a>
          <a class="btn secondary small" href="/model/profile">Back to Profile</a>
        </div>
      </div>

      <% if (!signature) { %>
        <div class="badbox" style="margin-top: 14px;">
          <div class="pill bad">Signature required</div>
          <p class="muted" style="margin: 10px 0 0 0;">
            You must complete <strong>Signature Setup</strong> before signing legal documents.
          </p>
          <div style="margin-top: 10px;">
            <a class="btn primary" href="/model/signature">Go to Signature Setup</a>
          </div>
        </div>
      <% } %>

      <% if (alreadySigned) { %>
        <div class="warnbox" style="margin-top: 14px;">
          <div class="pill ok">Already signed</div>
          <p class="muted" style="margin: 10px 0 0 0;">
            You have already signed the latest version of this document.
          </p>
        </div>
      <% } else if (needsResign) { %>
        <div class="warnbox" style="margin-top: 14px;">
          <div class="pill warn">Re-sign required</div>
          <p class="muted" style="margin: 10px 0 0 0;">
            This document was updated since your last signature. Please review and sign the updated version.
          </p>
        </div>
      <% } %>

      <div class="infobox" style="margin-top:14px;">
        <div class="pill">Executed Copy</div>
        <div class="muted" style="margin-top:8px;">
          When you sign, the system generates an <strong>executed PDF</strong> and stores it in the studio record system.
          Your signing timestamp, IP, and user agent are captured for audit.
        </div>
      </div>

      <div class="doc">
        <%- template && template.body_html ? template.body_html : '<p class="muted">No document body found.</p>' %>
      </div>

      <div class="sign">
        <div class="muted">
          Your signature on file: <span class="mono"><%= signature ? (signature.typed_name || signature.full_name || signature.legal_name || 'On file') : 'Missing' %></span>
        </div>

        <form action="/model/legal/<%= template.slug %>" method="POST">
          <% if (!alreadySigned) { %>
            <div class="checkbox">
              <input id="agree" name="agree" type="checkbox" />
              <label for="agree">
                I have read this document and I agree to the terms.
              </label>
            </div>
          <% } %>

          <div class="footer-actions" style="margin-top: 14px;">
            <a class="btn secondary" href="/model/legal">Back</a>

            <% if (alreadySigned) { %>
              <button class="btn secondary" type="button" disabled>
                Signed
              </button>
            <% } else { %>
              <button class="btn primary" type="submit" <%= !signature ? 'disabled' : '' %>>
                Sign & Generate PDF
              </button>
            <% } %>
          </div>
        </form>
      </div>

    </section>
  </main>
</body>
</html>
