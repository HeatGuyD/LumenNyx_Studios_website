<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <%
    // Be defensive: different routes may pass `user` or `modelUser`
    const safeModelUser = (typeof modelUser !== 'undefined') ? modelUser : null;
    const safeUser = (typeof user !== 'undefined') ? user : null;
    const u = safeModelUser || safeUser || {};
    const uname = (u && u.username) ? u.username : 'Model';

    // Optional: only if server passes CONTACT_EMAILS
    const emails = (typeof CONTACT_EMAILS !== 'undefined' && CONTACT_EMAILS) ? CONTACT_EMAILS : null;

    // Optional: allow server to pass a stable generated timestamp
    const generatedAt =
      (typeof generatedAt !== 'undefined' && generatedAt)
        ? generatedAt
        : new Date().toLocaleString();
  %>

  <title>Consent &amp; Safety Profile – <%= uname %></title>

  <!-- Keep your global styling available (buttons, typography, etc.) -->
  <link rel="stylesheet" href="/css/style.css" />

  <style>
    /* Screen layout (matches your dark UI vibe) */
    body { margin: 0; background:#111; color:#fafafa; }
    .print-container {
      max-width: 900px;
      margin: 1.75rem auto;
      background:#181818;
      padding: 1.75rem;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.12);
    }

    h1, h2 { margin: 0; }
    h1 { font-size: 1.35rem; margin-bottom: 0.2rem; }
    h2 { font-size: 1.05rem; margin-top: 1.15rem; margin-bottom: 0.35rem; }

    .meta {
      font-size: 0.9rem;
      color: #b7b7c9;
      margin: 0.35rem 0 1rem;
      line-height: 1.35;
    }

    ul { margin: 0.4rem 0 0 1.1rem; padding: 0; }
    li { margin: 0.25rem 0; }

    .note {
      margin-top: 1.2rem;
      font-size: 0.85rem;
      color: #b7b7c9;
      line-height: 1.4;
    }

    .box {
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 14px;
      padding: 12px 14px;
      margin-top: 12px;
      background: rgba(255,255,255,0.03);
    }

    .blank-lines { margin-top: 8px; }
    .blank-line {
      border-bottom: 1px solid rgba(255,255,255,0.20);
      height: 18px;
      margin: 10px 0;
    }

    .checkrow { margin: 8px 0; color:#e8e8f2; }
    .check {
      display:inline-block;
      width: 14px; height: 14px;
      border: 1px solid rgba(255,255,255,0.65);
      margin-right: 8px;
      vertical-align: middle;
      border-radius: 3px;
    }

    a { color: inherit; }

    /* Print rules */
    @media print {
      .no-print { display: none !important; }
      body { background:#fff; color:#000; }
      .print-container {
        max-width: none;
        margin: 0;
        border: none;
        border-radius: 0;
        background:#fff;
        padding: 0.75rem 0.75rem 0;
      }
      .meta, .note { color:#333; }
      .box { border: 1px solid #bbb; background:#fff; }
      .blank-line { border-bottom: 1px solid #bbb; }
      .check { border: 1px solid #444; }
      a { color:#000; text-decoration: none; }
    }
  </style>
</head>

<body>
  <div class="print-container">
    <div class="no-print" style="text-align:right; margin-bottom: 10px;">
      <button class="btn secondary" onclick="window.print()">Print / Save as PDF</button>
    </div>

    <h1>LumenNyx Studios – Consent &amp; Safety Profile</h1>
    <div class="meta">
      Username: <strong><%= uname %></strong><br>
      Generated: <%= generatedAt %><br>

      <% if (emails && (emails.support || emails.legal || emails.release)) { %>
        Support:
        <a href="mailto:<%= emails.support || '' %>"><%= emails.support || '—' %></a>
        &nbsp;|&nbsp;
        Legal:
        <a href="mailto:<%= emails.legal || '' %>"><%= emails.legal || '—' %></a>
        &nbsp;|&nbsp;
        Releases:
        <a href="mailto:<%= emails.release || '' %>"><%= emails.release || '—' %></a>
      <% } %>
    </div>

    <% if (!policies) { %>
      <p>No consent / safety profile has been saved for this model.</p>

      <div class="box">
        <h2>Additional Preferences (Fill-in)</h2>
        <p class="meta" style="margin-top:0;">
          Use this section for additional do’s / don’ts and any last-minute scope notes.
        </p>

        <div class="checkrow"><span class="check"></span> BTS / behind-the-scenes or promo content discussed separately</div>
        <div class="checkrow"><span class="check"></span> No BTS / promo recording beyond what is agreed in writing</div>

        <div class="blank-lines">
          <div><strong>Do’s / OK if agreed:</strong></div>
          <div class="blank-line"></div>
          <div class="blank-line"></div>
          <div class="blank-line"></div>

          <div style="margin-top:10px;"><strong>Don’ts / Not OK:</strong></div>
          <div class="blank-line"></div>
          <div class="blank-line"></div>
          <div class="blank-line"></div>

          <div style="margin-top:10px;"><strong>Notes / triggers / safety needs:</strong></div>
          <div class="blank-line"></div>
          <div class="blank-line"></div>
        </div>
      </div>

    <% } else { %>
      <h2>General Comfort &amp; Consent</h2>
      <ul>
        <li>Kissing: <%= policies.consent_allows_kissing ? 'Generally OK' : 'Not checked' %></li>
        <li>Nudity: <%= policies.consent_allows_nudity ? 'OK' : 'Not checked' %></li>
        <li>Rough / intense themes: <%= policies.consent_allows_rough ? 'Open with limits' : 'Not checked' %></li>
        <li>Breath-related fantasy content: <%= policies.consent_allows_choking ? 'Open with limits' : 'Not checked' %></li>
      </ul>

      <h2>Hard Limits (Never OK)</h2>
      <p><%= policies.consent_hard_limits || '(none listed)' %></p>

      <h2>Soft Limits (“Ask First”)</h2>
      <p><%= policies.consent_soft_limits || '(none listed)' %></p>

      <h2>On-Set Safety Rules</h2>
      <ul>
        <li>No illegal drugs / no performing while impaired: <%= policies.policy_no_substances ? 'Acknowledged' : 'Not checked' %></li>
        <li>Safe word stops all activity: <%= policies.policy_safe_word ? 'Acknowledged' : 'Not checked' %></li>
        <li>Breaks allowed: <%= policies.policy_breaks ? 'Acknowledged' : 'Not checked' %></li>
        <li>Reporting unsafe behavior: <%= policies.policy_reporting ? 'Acknowledged' : 'Not checked' %></li>
      </ul>

      <h2>Content Removal Expectations</h2>
      <ul>
        <li>Understands full internet removal is not guaranteed: <%= policies.policy_understand_no_guaranteed_removal ? 'Yes' : 'Not checked' %></li>
        <li>May request internal takedowns in good faith: <%= policies.policy_internal_requests ? 'Yes' : 'Not checked' %></li>
      </ul>
      <p><strong>Removal notes:</strong> <%= policies.policy_removal_notes || '(none)' %></p>

      <% if (emails && emails.release) { %>
        <p>
          <strong>Release / removal requests:</strong>
          <a href="mailto:<%= emails.release %>"><%= emails.release %></a>
        </p>
      <% } %>

      <h2>Contractor Acknowledgement</h2>
      <ul>
        <li>Independent contractor, not employee: <%= policies.contractor_acknowledge ? 'Yes' : 'Not checked' %></li>
        <li>Digital signature / typed name: <%= policies.contractor_signature || '(none)' %></li>
      </ul>

      <div class="box">
        <h2>Additional Preferences (Fill-in)</h2>
        <p class="meta" style="margin-top:0;">
          Optional. Use for “do’s / don’ts,” BTS/promo preferences, and any last-minute scope notes.
          Keep this high-level and non-graphic.
        </p>

        <div class="checkrow"><span class="check"></span> BTS / behind-the-scenes or promo content discussed separately</div>
        <div class="checkrow"><span class="check"></span> No BTS / promo recording beyond what is agreed in writing</div>

        <div class="blank-lines">
          <div><strong>Do’s / OK if agreed:</strong></div>
          <div class="blank-line"></div>
          <div class="blank-line"></div>
          <div class="blank-line"></div>

          <div style="margin-top:10px;"><strong>Don’ts / Not OK:</strong></div>
          <div class="blank-line"></div>
          <div class="blank-line"></div>
          <div class="blank-line"></div>

          <div style="margin-top:10px;"><strong>Notes / triggers / safety needs:</strong></div>
          <div class="blank-line"></div>
          <div class="blank-line"></div>
        </div>
      </div>

      <p class="note">
        This consent profile is a planning and safety reference. Scene-specific agreements should still be used
        to document partners, restrictions, and stop-words for each shoot.
      </p>
    <% } %>
  </div>
</body>
</html>
